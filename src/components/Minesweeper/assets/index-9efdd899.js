var D=Object.defineProperty;var I=(u,e,t)=>e in u?D(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t;var n=(u,e,t)=>(I(u,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();const b='<img class="icon" src="images/flag.svg" />',L='<img class="icon" src="/images/bomb.png" />';class T{constructor(e,t,s){n(this,"x");n(this,"y");n(this,"value",0);n(this,"element",null);n(this,"containsBomb",!1);n(this,"clicked",!1);n(this,"flagged",!1);n(this,"frozen",!1);n(this,"parent");this.x=e,this.y=t,this.parent=s}setValue(e){this.value=e}getElement(){return this.element=document.createElement("div"),this.element.classList.add("cell","hidden"),this.element.addEventListener("mousedown",e=>this.click(e)),this.element.addEventListener("contextmenu",e=>e.preventDefault()),this.element}revealCell(){this.clicked=!0,this.parent.increment(),this.element&&(this.element.classList.remove("hidden"),this.element.classList.add("revealed"),this.element.dataset.value=this.value.toString(),this.value>0&&(this.element.innerText=this.value.toString()))}click(e){if(!this.frozen){if((e==null?void 0:e.button)===1){this.clicked&&this.parent.revealSurrounding(this.x,this.y);return}if(!this.clicked&&(e==null?void 0:e.button)===2){e.preventDefault(),this.toggleFlag();return}if(!(this.clicked||this.flagged)){if(this.containsBomb){this.explode();return}this.revealCell(),this.value===0&&this.parent.revealSurrounding(this.x,this.y)}}}explode(){this.parent.explode(this.x,this.y),this.element.classList.add("exploded"),this.element.innerHTML=L}toggleFlag(){this.flagged?(this.flagged=!1,this.element.innerHTML=""):(this.flagged=!0,this.element.innerHTML=b)}endGame({win:e}){this.frozen=!0,this.containsBomb&&!this.flagged&&!this.clicked&&(e?this.element.innerHTML=b:this.element.innerHTML=L)}}class S{constructor({parent:e,width:t,height:s,numberOfMines:i=20}){n(this,"children",[]);n(this,"remainingCells");n(this,"parent");n(this,"timerDiv");n(this,"minesRemainingDiv");n(this,"buttonElement");n(this,"timerIntervalId",null);n(this,"mouseDownListener",e=>{e.button===0&&this.buttonElement.style.setProperty("--image-position","top right")});n(this,"mouseUpListener",()=>{this.buttonElement.style.cssText=""});n(this,"startTimer",()=>{console.log("starting timer"),this.timerDiv&&(this.timerIntervalId&&(this.timerDiv.innerText="000",clearInterval(this.timerIntervalId)),this.timerIntervalId=setInterval(()=>{const e=Number(this.timerDiv.innerText);this.timerDiv.innerText=(e+1).toString().padStart(3,"0")},1e3))});this.remainingCells=t*s-i,this.parent=e,this.minesRemainingDiv=document.getElementById("mines-remaining"),this.timerDiv=document.getElementById("time-elapsed"),this.buttonElement=document.getElementById("new-game-button");for(let o=0;o<t;o++){const r=[],d=document.createElement("div");d.classList.add("column");for(let c=0;c<s;c++){const m=new T(o,c,this),h=m.getElement();r.push(m),d.append(h)}this.children.push(r),e.append(d)}this.generateMines(i),this.generateValues(),this.parent.addEventListener("click",this.startTimer,{once:!0}),this.parent.addEventListener("mousedown",this.mouseDownListener),this.parent.addEventListener("mouseup",this.mouseUpListener)}revealSurrounding(e,t){this.getSurroundingCells(e,t).forEach(i=>i.click())}explode(e,t){console.log(e,t,"exploded!"),this.buttonElement.classList.add("game-lost"),this.endGame({win:!1})}increment(){this.remainingCells--,this.minesRemainingDiv.innerText=this.remainingCells.toString().padStart(3,"0"),this.remainingCells===0&&(this.buttonElement.classList.add("game-won"),this.endGame({win:!0}))}getSurroundingCells(e,t){var i,o,r,d,c,m,h,f;return[(i=this.children[e-1])==null?void 0:i[t-1],(o=this.children[e])==null?void 0:o[t-1],(r=this.children[e+1])==null?void 0:r[t-1],(d=this.children[e-1])==null?void 0:d[t],(c=this.children[e+1])==null?void 0:c[t],(m=this.children[e-1])==null?void 0:m[t+1],(h=this.children[e])==null?void 0:h[t+1],(f=this.children[e+1])==null?void 0:f[t+1]].filter(l=>l)}generateMines(e){for(let t=0;t<e;t++){let s=!1;for(;!s;){const i=Math.floor(Math.random()*this.children.length),o=Math.floor(Math.random()*this.children[0].length);this.children[i][o].containsBomb!==!0&&(this.children[i][o].containsBomb=!0,s=!0)}}}generateValues(){this.children.forEach((e,t)=>{e.forEach((s,i)=>{const r=this.getSurroundingCells(t,i).reduce((d,c)=>c.containsBomb?d+1:d,0);s.setValue(r)})})}endGame({win:e}){this.forEachChild(t=>t.endGame({win:e})),requestAnimationFrame(()=>{this.timerIntervalId&&clearInterval(this.timerIntervalId)})}forEachChild(e){this.children.forEach(t=>t.forEach(s=>e(s)))}reset(){this.children=[],this.parent.innerHTML="",this.buttonElement.style.cssText="",this.buttonElement.className="",this.timerIntervalId&&clearInterval(this.timerIntervalId),this.timerDiv.innerText="000",this.minesRemainingDiv.innerText="000",this.parent.removeEventListener("click",this.startTimer),this.parent.removeEventListener("mousedown",this.mouseDownListener),this.parent.removeEventListener("mouseup",this.mouseUpListener)}}class p{constructor({element:e,top:t=0,left:s=0}){n(this,"windowElement");n(this,"defaultX");n(this,"defaultY");n(this,"x");n(this,"y");const i=e.querySelector(".window-title-bar"),o=e.querySelector(".close-button");if(!e||!i||!o)throw new Error("missing elements in Window element, check your html");t&&(e.style.top=`${t}px`),s&&(e.style.left=`${s}px`),this.windowElement=e,this.x=this.defaultX=t,this.y=this.defaultY=s,o.addEventListener("click",()=>this.hide()),e.querySelectorAll("button"),i.addEventListener("mousedown",r=>{const d=r.clientX,c=r.clientY,m=h=>{const f=h.clientX-d,l=h.clientY-c;this.windowElement.style.left=`${this.x+f}px`,this.windowElement.style.top=`${this.y+l}px`};document.addEventListener("mousemove",m),document.addEventListener("mouseup",h=>{const f=h.clientX-d,l=h.clientY-c,a=this.x+f,v=this.y+l;this.windowElement.style.left=`${a}px`,this.windowElement.style.top=`${v}px`,this.x=a,this.y=v,document.removeEventListener("mousemove",m)},{once:!0})})}show(){this.windowElement.classList.remove("window-hidden")}hide(){this.windowElement.classList.add("window-hidden"),this.x=this.defaultX,this.y=this.defaultY}}class B extends p{constructor(t){super(t);n(this,"setSize");n(this,"inputs");this.setSize=t.setSize;const s=t.element.querySelectorAll("input");if(s.length!==3)throw new Error("missing inputs in SizeSelectorWindow");this.inputs=s,t.element.querySelectorAll(".cancel-button").forEach(r=>r.addEventListener("click",()=>this.hide())),t.element.querySelectorAll(".ok-button").forEach(r=>r.addEventListener("click",()=>{this.submit(),this.hide()}))}submit(){const t={};this.inputs.forEach(s=>{t[s.name]=s.value}),this.setSize(t)}}const E={easy:{width:10,height:10,numberOfMines:10},medium:{width:30,height:20,numberOfMines:60},hard:{width:30,height:30,numberOfMines:120}};class k{constructor(e){n(this,"parentElement");n(this,"newGameButton");n(this,"minefieldDiv");n(this,"dropdownMenuButtons");n(this,"gameOptions");n(this,"minefield");n(this,"dropdownMenuOpen",!1);n(this,"customSizeWindow",null);n(this,"aboutWindow",null);n(this,"howToPlayWindow",null);n(this,"setSize",e=>{this.gameOptions={...this.gameOptions,...e},this.startNewGame()});const t=e.querySelector("#new-game-button"),s=e.querySelector("#minefield"),i=e.querySelectorAll(".dropdown-menu-button"),o=e.querySelectorAll(".difficulty-selector-button"),r=e.querySelector("#menu");if(!t||!s||!r||i.length===0||o.length===0)throw new Error("missing elements, please check html");this.newGameButton=t,this.minefieldDiv=s,this.parentElement=e,this.gameOptions={parent:this.minefieldDiv,...E.medium},this.minefield=new S(this.gameOptions),this.dropdownMenuButtons=i,this.newGameButton.addEventListener("click",()=>this.startNewGame()),i.forEach(l=>{l.addEventListener("click",a=>{a.target===l&&this.openDropdownMenu(l)}),l.addEventListener("mouseover",()=>{this.dropdownMenuOpen&&this.openDropdownMenu(l)})}),r.addEventListener("mouseleave",()=>{this.dropdownMenuOpen&&this.closeDropdownMenus()}),o.forEach(l=>{l.addEventListener("click",a=>{const g=a.target.dataset.difficulty;g&&E[g]?(this.gameOptions={...this.gameOptions,...E[g]},this.startNewGame()):g==="custom"&&this.customSizeWindow&&this.customSizeWindow.show(),this.closeDropdownMenus()})});const d=e.querySelector("#how-to-play-button");d?d.addEventListener("click",()=>{var l;(l=this.howToPlayWindow)==null||l.show()}):console.error("no How To Play button element found in HTML");const c=e.querySelector("#about-button");c?c.addEventListener("click",()=>{var l;(l=this.aboutWindow)==null||l.show()}):console.error("no About button element found in HTML");const m=e.querySelector("#custom-size-select");m?this.customSizeWindow=new B({element:m,top:100,left:100,setSize:this.setSize}):console.error("no custom size selector element found, no custom sizes will be useable");const h=e.querySelector("#about-window");if(h){this.aboutWindow=new p({element:h,top:115,left:115});const l=h.querySelector(".ok-button");l==null||l.addEventListener("click",()=>{var a;return(a=this.aboutWindow)==null?void 0:a.hide()})}else console.error("no About window elements found");const f=e.querySelector("#how-to-play-window");if(f){this.howToPlayWindow=new p({element:f,top:130,left:130});const l=f.querySelector(".ok-button");l==null||l.addEventListener("click",()=>{var a;return(a=this.howToPlayWindow)==null?void 0:a.hide()})}else console.error("no How To Play window elements found")}startNewGame(){this.minefield&&this.minefield.reset(),this.minefield=new S(this.gameOptions)}openDropdownMenu(e){this.dropdownMenuOpen=!0,this.dropdownMenuButtons.forEach(t=>{const s=t.querySelector(".dropdown-menu");s&&(t===e?s.style.display="flex":s.style.display="none")})}closeDropdownMenus(){this.dropdownMenuOpen=!1,this.parentElement.querySelectorAll(".dropdown-menu").forEach(e=>e.style.display="none")}}const M=document.getElementById("game");M&&new k(M);let w=null;const x=document.querySelector(".window");x&&(w=new p({element:x,top:50,left:50}),w.hide());const y=document.getElementById("minesweeper-button");y==null||y.addEventListener("dblclick",()=>{w==null||w.show()});
